"use strict";(self.webpackChunktgg_sredocs=self.webpackChunktgg_sredocs||[]).push([[377],{7034:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>a,contentTitle:()=>r,default:()=>h,frontMatter:()=>i,metadata:()=>l,toc:()=>d});var s=t(4848),o=t(8453);const i={sidebar_position:1,title:"Tools"},r="Application deployment tools",l={id:"app_deployment/tools",title:"Tools",description:"Kubernetes-based",source:"@site/docs/app_deployment/tools.md",sourceDirName:"app_deployment",slug:"/app_deployment/tools",permalink:"/docs/app_deployment/tools",draft:!1,unlisted:!1,editUrl:"https://github.com/broadinstitute/tgg-sredocs/tree/main/docs/app_deployment/tools.md",tags:[],version:"current",sidebarPosition:1,frontMatter:{sidebar_position:1,title:"Tools"},sidebar:"docsSidebar",previous:{title:"App Deployment",permalink:"/docs/category/app-deployment"},next:{title:"gnomAD",permalink:"/docs/app_deployment/gnomad"}},a={},d=[{value:"Kubernetes-based",id:"kubernetes-based",level:2},{value:"Kustomize",id:"kustomize",level:3},{value:"Helm",id:"helm",level:3},{value:"Argo",id:"argo",level:3},{value:"Secret Synchronization",id:"secret-synchronization",level:3},{value:"DNS Registration",id:"dns-registration",level:3},{value:"TLS Certificates",id:"tls-certificates",level:3},{value:"Ingress / Load balancing",id:"ingress--load-balancing",level:3}];function c(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",li:"li",ol:"ol",p:"p",pre:"pre",ul:"ul",...(0,o.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.h1,{id:"application-deployment-tools",children:"Application deployment tools"}),"\n",(0,s.jsx)(n.h2,{id:"kubernetes-based",children:"Kubernetes-based"}),"\n",(0,s.jsx)(n.p,{children:"Many of our deployments utilize kubernetes for its ability to facilitate consistent deployment patterns for container-based applications, and its cross-cloud compatibility. The tool used to manage kubernetes manifests is largely left up to each of the teams, but in general, we've coalesced on the following principles:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["Deployments that only need very simple manifest management (application of labels, naming pre/suffixes, small patches, image updates) use ",(0,s.jsx)(n.a,{href:"https://kustomize.io",children:"Kustomize"})]}),"\n",(0,s.jsxs)(n.li,{children:["Deployments that need more complicated templating logic, or need to provide a consumable installation method for open source end-users use ",(0,s.jsx)(n.a,{href:"https://helm.sh",children:"Helm"})]}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"kustomize",children:"Kustomize"}),"\n",(0,s.jsx)(n.p,{children:"Typical deployments should be structured as follows:"}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsxs)(n.li,{children:["Application manifests stored separately from the code (e.g. ",(0,s.jsx)(n.a,{href:"https://github.com/broadinstitute/gnomad-deployments",children:"https://github.com/broadinstitute/gnomad-deployments"}),")"]}),"\n",(0,s.jsx)(n.li,{children:"A lowest common denominator deployment 'base'. This is a set of manifests that can be used for a basis for any kind of deployment (local development, demo, production, etc)."}),"\n",(0,s.jsx)(n.li,{children:"Generally, development environments should optimize for lower resource usage, and fewer replicas than production deployments."}),"\n",(0,s.jsx)(n.li,{children:"A directory of 'overlays' for various environments."}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:"In this pattern, we would have a persistent set of overlays for long-lived environments such as production. Applications could optionally have a example 'development' overlay that could be copied as needed for development purposes."}),"\n",(0,s.jsx)(n.p,{children:"When using an example development overlay as a base, you might instantiate a new development environment like so:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:'# create a new folder in your application\'s overlays directory\n$ mkdir my-demo && cd my-demo\n$ kustomize init --resources ../path/to/development-overlay --namesuffix "my-demo"\n$ kustomize edit set image MY-IMAGE-NAME=us-docker.pkg.dev/my-project/my-repo/my-dev-image:a259229-my-tag\n'})}),"\n",(0,s.jsx)(n.p,{children:"This will create a new kustomization.yaml file, sets a name suffix to make your demo unique, and sets the deployment's docker image image to use a development repository and tag."}),"\n",(0,s.jsx)(n.p,{children:"Depending on how it's written, you could also just take the development overlay as-is by copying it, and modifying values:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"$ cp -r development my-demo\n$ vim my-demo/kustomization.yaml # edit as needed\n"})}),"\n",(0,s.jsx)(n.p,{children:"To check or verify the manifests generated by your kustomization, cd into the directory containing your kustomization file, and run the build command:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"$ kustomize build .\n"})}),"\n",(0,s.jsxs)(n.p,{children:["This output can be piped to kubectl apply to deploy directly (appropriate for dev/demo envs), or ",(0,s.jsx)(n.a,{href:"#argo",children:"Argo"})," can be configured to deploy it for you (appropriate for persistent/production environments)"]}),"\n",(0,s.jsx)(n.h3,{id:"helm",children:"Helm"}),"\n",(0,s.jsxs)(n.p,{children:["In cases where we need to provide a standard installation method for public consumption, Helm should be used (e.g. ",(0,s.jsx)(n.a,{href:"https://github.com/broadinstitute/seqr-helm",children:"https://github.com/broadinstitute/seqr-helm"}),"). This allows for a curated deployment with expected variables and inputs, to provide a more streamlined experience for our end users."]}),"\n",(0,s.jsx)(n.p,{children:"Easy publishing of a helm repository can be orchestrated with the chart-releaser tool and its associated github action:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"https://github.com/helm/chart-releaser",children:"chart-releaser"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"https://github.com/helm/chart-releaser-action",children:"chart-releaser-action"})}),"\n"]}),"\n",(0,s.jsxs)(n.p,{children:["See the ",(0,s.jsx)(n.a,{href:"https://github.com/broadinstitute/seqr-helm/blob/adfbac8db4939d42db2d2a02842029e11da165d4/.github/workflows/release_chart.yaml",children:"seqr-helm"})," release workflow for an example configuration."]}),"\n",(0,s.jsx)(n.h3,{id:"argo",children:"Argo"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"https://argoproj.github.io/cd/",children:"ArgoCD"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"https://argoproj.github.io/rollouts/",children:"Argo Rollouts"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"https://argocd.sre.the-tgg.dev/",children:"TGG Argo Instance"})}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:"Argo is a tool that is used to manage deployments onto our GKE clusters. In simple terms, you point it at a git repository containing your deployment configuration (whether that is Kustomizations, Helm Charts, or simple yaml manifests), and Argo can automatically deploy changes when it sees them."}),"\n",(0,s.jsx)(n.p,{children:"Available deployment strategies include:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Automatically deploy changes as soon as a deployment object in git is changed"}),"\n",(0,s.jsx)(n.li,{children:"Pin to a specific commit and require a manual sync"}),"\n",(0,s.jsx)(n.li,{children:"Follow a git tag regex, and only deploy when a tag matching the regex is pushed"}),"\n",(0,s.jsxs)(n.li,{children:["More complicated deployment strategies (such as blue/green or canary) are available through ",(0,s.jsx)(n.a,{href:"https://argoproj.github.io/rollouts/",children:"Argo Rollouts"})]}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"secret-synchronization",children:"Secret Synchronization"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"https://external-secrets.io",children:"External Secrets"})}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"dns-registration",children:"DNS Registration"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"https://kubernetes-sigs.github.io/external-dns/",children:"External DNS"})}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"tls-certificates",children:"TLS Certificates"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"https://cloud.google.com/kubernetes-engine/docs/how-to/managed-certs",children:"ManagedCertificates"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"https://cert-manager.io/",children:"cert-manager"})}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"ingress--load-balancing",children:"Ingress / Load balancing"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"https://cloud.google.com/kubernetes-engine/docs/concepts/ingress",children:"GKE Ingress"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"https://kubernetes.github.io/ingress-nginx/",children:"Ingress-NGINX"})}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,o.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(c,{...e})}):c(e)}},8453:(e,n,t)=>{t.d(n,{R:()=>r,x:()=>l});var s=t(6540);const o={},i=s.createContext(o);function r(e){const n=s.useContext(i);return s.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(o):e.components||o:r(e.components),s.createElement(i.Provider,{value:n},e.children)}}}]);